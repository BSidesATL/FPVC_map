<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon">
    <meta charset=utf-8 />
    <title>FPV Chat Members</title>

    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.css' rel='stylesheet' />
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet">
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>
    <style>
	.marker {
    	display: block;
	    border: none;
	    border-radius: 50%;
	    cursor: pointer;
	    padding: 0;
	}
    </style>

    <div id='map'></div>

    <div id='content'>
        <div class="sidecontainer">
            <h1>FPV Chat Members</h1>
            <h4>A map of participants in the <a target="_blank" href="http://fpv-chat.com/">FPVC</a> Slack community | <a target="_blank" href="http://kernelsndrs.github.io/FPVC_map/">Add yourself!</a></h4>
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.js'></script>

    <script>
    $.getJSON("https://spreadsheets.google.com/feeds/list/1Dvls_Hk-goeydu4kJoRWwS_ZmD55scbvG-wEugmYt54/1/public/values?alt=json", function(data) {
        mapboxgl.accessToken = 'pk.eyJ1Ijoia2VybmVsc25kcnMiLCJhIjoiY2luOTZhMDg3MW1rZHRta3NpbHo5dXc4YiJ9.fe9jvqMz6sZh_h8Yx9olfw';
	var map = new mapboxgl.Map({
	    container: 'map',
	    style: 'mapbox://styles/kernelsndrs/cj140c07t001q2rtn53py28tw',
	    zoom: 0,
	    center: [-39.12367, -0.81229],
	    renderWorldCopies: false
	});
        var brewers = data.feed.entry;

        var brewerGeojson = {type: 'FeatureCollection', features: []};

        for (var i in brewers) {
            if (brewers[i].gsx$latitude.$t) {
                var feature = {
                    type: 'Feature',
                    properties: {
                        title: '<h1>' + brewers[i].gsx$name.$t + '</h1>',
                        url: 'https://fpvchat.slack.com/team/' + brewers[i].gsx$name.$t,
			
			'iconSize': [50,50],
			
                    },
                    geometry: {
                        'type': 'Point',
                        'coordinates': [brewers[i].gsx$longitude.$t, brewers[i].gsx$latitude.$t],
                    }
                };
                brewerGeojson.features.push(feature);
            }
        }
	brewerGeojson.features.forEach(function(marker) {
   	  // create a DOM element for the marker
	  var el = document.createElement('div');
	  el.className = 'marker';
	  el.style.backgroundImage = 'url(https://cdn.shopify.com/s/files/1/0991/6686/products/Le-Hyphy-FPV-Frame-Side_large.jpg?v=1481002981)';
	  el.style.width = marker.properties.iconSize[0] + 'px';
	  el.style.height = marker.properties.iconSize[1] + 'px';

	  el.addEventListener('click', function() {
              window.alert(marker.properties.message);
	  });

	  // add marker to map
	  new mapboxgl.Marker(el, {offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2]})
	      .setLngLat(marker.geometry.coordinates)
	      .addTo(map);
	});
		
	
    });
    </script>

</body>
</html>
